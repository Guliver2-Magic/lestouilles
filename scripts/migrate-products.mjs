import { drizzle } from "drizzle-orm/mysql2";
import { products } from "../drizzle/schema.ts";
import * as dotenv from "dotenv";

// Load environment variables
dotenv.config();

// Import menu data
const menuData = {
  sandwiches: [
    {
      name: "Le Végétarien",
      description: "Sandwich végétarien avec légumes grillés et houmous",
      price: 1200,
      servingSize: "1 personne",
      image: "/images/menu/vegetarian-sandwich.jpg",
      calories: 380,
      protein: 12,
      carbs: 52,
      fat: 14,
      nutritionalTip: "Riche en fibres et en protéines végétales",
      isVegetarian: true,
      isVegan: false,
      isGlutenFree: false,
      isDairyFree: false,
    },
    {
      name: "Le Poulet",
      description: "Sandwich au poulet grillé avec laitue et tomate",
      price: 1400,
      servingSize: "1 personne",
      image: "/images/menu/chicken-sandwich.jpg",
      calories: 420,
      protein: 28,
      carbs: 45,
      fat: 12,
      nutritionalTip: "Excellente source de protéines maigres",
      isVegetarian: false,
      isVegan: false,
      isGlutenFree: false,
      isDairyFree: false,
    },
    {
      name: "Le Smoked Meat",
      description: "Sandwich au smoked meat de Montréal avec moutarde",
      price: 1600,
      servingSize: "1 personne",
      image: "/images/menu/smoked-meat.jpg",
      calories: 520,
      protein: 32,
      carbs: 48,
      fat: 22,
      nutritionalTip: "Riche en protéines, à consommer avec modération",
      isVegetarian: false,
      isVegan: false,
      isGlutenFree: false,
      isDairyFree: false,
    },
  ],
  salades: [
    {
      name: "Salade César",
      description: "Salade césar classique avec poulet grillé",
      price: 1300,
      servingSize: "1 personne",
      image: "/images/menu/caesar-salad.jpg",
      calories: 350,
      protein: 24,
      carbs: 18,
      fat: 22,
      nutritionalTip: "Bonne source de protéines et de vitamines",
      isVegetarian: false,
      isVegan: false,
      isGlutenFree: true,
      isDairyFree: false,
    },
    {
      name: "Salade Grecque",
      description: "Salade grecque avec feta, olives et concombre",
      price: 1200,
      servingSize: "1 personne",
      image: "/images/menu/greek-salad.jpg",
      calories: 280,
      protein: 10,
      carbs: 15,
      fat: 20,
      nutritionalTip: "Riche en antioxydants et en gras sains",
      isVegetarian: true,
      isVegan: false,
      isGlutenFree: true,
      isDairyFree: false,
    },
  ],
  "plats-principaux": [
    {
      name: "Lasagne",
      description: "Lasagne maison avec sauce bolognaise",
      price: 1800,
      servingSize: "1 personne",
      image: "/images/menu/lasagna.jpg",
      calories: 580,
      protein: 28,
      carbs: 62,
      fat: 24,
      nutritionalTip: "Plat complet et réconfortant",
      isVegetarian: false,
      isVegan: false,
      isGlutenFree: false,
      isDairyFree: false,
    },
    {
      name: "Poulet Rôti",
      description: "Poulet rôti avec légumes de saison",
      price: 2000,
      servingSize: "1 personne",
      image: "/images/menu/roasted-chicken.jpg",
      calories: 480,
      protein: 42,
      carbs: 28,
      fat: 18,
      nutritionalTip: "Excellente source de protéines maigres",
      isVegetarian: false,
      isVegan: false,
      isGlutenFree: true,
      isDairyFree: true,
    },
  ],
  "traiteur-bouchees": [
    {
      name: "Canapés Assortis",
      description: "Assortiment de canapés variés",
      price: 3500,
      servingSize: "8-10 personnes",
      image: "/images/menu/canapes.jpg",
      calories: 120,
      protein: 4,
      carbs: 12,
      fat: 6,
      nutritionalTip: "Parfait pour les cocktails",
      isVegetarian: false,
      isVegan: false,
      isGlutenFree: false,
      isDairyFree: false,
    },
    {
      name: "Mini Quiches",
      description: "Mini quiches lorraines",
      price: 3000,
      servingSize: "8-10 personnes",
      image: "/images/menu/mini-quiches.jpg",
      calories: 180,
      protein: 8,
      carbs: 14,
      fat: 10,
      nutritionalTip: "Riche en protéines",
      isVegetarian: true,
      isVegan: false,
      isGlutenFree: false,
      isDairyFree: false,
    },
    {
      name: "Brochettes de Poulet",
      description: "Brochettes de poulet mariné",
      price: 4000,
      servingSize: "8-10 personnes",
      image: "/images/menu/chicken-skewers.jpg",
      calories: 220,
      protein: 24,
      carbs: 8,
      fat: 10,
      nutritionalTip: "Excellente source de protéines",
      isVegetarian: false,
      isVegan: false,
      isGlutenFree: true,
      isDairyFree: true,
    },
  ],
  "traiteur-buffets": [
    {
      name: "Buffet Froid",
      description: "Buffet froid avec charcuteries et fromages",
      price: 4500,
      servingSize: "8-10 personnes",
      image: "/images/menu/cold-buffet.jpg",
      calories: 450,
      protein: 18,
      carbs: 32,
      fat: 28,
      nutritionalTip: "Varié et équilibré",
      isVegetarian: false,
      isVegan: false,
      isGlutenFree: false,
      isDairyFree: false,
    },
    {
      name: "Buffet Chaud",
      description: "Buffet chaud avec plats mijotés",
      price: 5000,
      servingSize: "8-10 personnes",
      image: "/images/menu/hot-buffet.jpg",
      calories: 520,
      protein: 28,
      carbs: 48,
      fat: 22,
      nutritionalTip: "Réconfortant et copieux",
      isVegetarian: false,
      isVegan: false,
      isGlutenFree: false,
      isDairyFree: false,
    },
  ],
  "boites-lunch": [
    {
      name: "Boîte à Lunch Classique",
      description: "Sandwich, salade, dessert et boisson",
      price: 1800,
      servingSize: "1 personne",
      image: "/images/menu/lunch-box-classic.jpg",
      calories: 650,
      protein: 28,
      carbs: 72,
      fat: 24,
      nutritionalTip: "Repas complet et équilibré",
      isVegetarian: false,
      isVegan: false,
      isGlutenFree: false,
      isDairyFree: false,
    },
    {
      name: "Boîte à Lunch Végétarienne",
      description: "Sandwich végé, salade, dessert et boisson",
      price: 1600,
      servingSize: "1 personne",
      image: "/images/menu/lunch-box-veggie.jpg",
      calories: 580,
      protein: 18,
      carbs: 68,
      fat: 22,
      nutritionalTip: "Option santé et savoureuse",
      isVegetarian: true,
      isVegan: false,
      isGlutenFree: false,
      isDairyFree: false,
    },
  ],
  desserts: [
    {
      name: "Brownie au Chocolat",
      description: "Brownie fondant au chocolat noir",
      price: 600,
      servingSize: "1 personne",
      image: "/images/menu/brownie.jpg",
      calories: 380,
      protein: 5,
      carbs: 48,
      fat: 20,
      nutritionalTip: "Riche en chocolat noir",
      isVegetarian: true,
      isVegan: false,
      isGlutenFree: false,
      isDairyFree: false,
    },
    {
      name: "Carré aux Dattes",
      description: "Carré traditionnel aux dattes",
      price: 550,
      servingSize: "1 personne",
      image: "/images/menu/date-square.jpg",
      calories: 320,
      protein: 4,
      carbs: 52,
      fat: 12,
      nutritionalTip: "Source naturelle de fibres",
      isVegetarian: true,
      isVegan: false,
      isGlutenFree: false,
      isDairyFree: false,
    },
    {
      name: "Tiramisu au Bailey's",
      description: "Tiramisu crémeux au Bailey's",
      price: 700,
      servingSize: "1 personne",
      image: "/images/menu/tiramisu.jpg",
      calories: 420,
      protein: 8,
      carbs: 42,
      fat: 24,
      nutritionalTip: "Dessert onctueux et raffiné",
      isVegetarian: true,
      isVegan: false,
      isGlutenFree: false,
      isDairyFree: false,
    },
    {
      name: "Pain aux Bananes et Chocolat",
      description: "Pain moelleux aux bananes et pépites de chocolat",
      price: 500,
      servingSize: "1 personne",
      image: "/images/menu/banana-bread.jpg",
      calories: 280,
      protein: 5,
      carbs: 42,
      fat: 10,
      nutritionalTip: "Bon pour le moral",
      isVegetarian: true,
      isVegan: false,
      isGlutenFree: false,
      isDairyFree: false,
    },
  ],
  boissons: [
    {
      name: "Café",
      description: "Café fraîchement préparé",
      price: 300,
      servingSize: "1 tasse",
      image: "/images/menu/coffee.jpg",
      calories: 5,
      protein: 0,
      carbs: 0,
      fat: 0,
      nutritionalTip: "Stimulant naturel",
      isVegetarian: true,
      isVegan: true,
      isGlutenFree: true,
      isDairyFree: true,
    },
    {
      name: "Jus d'Orange",
      description: "Jus d'orange fraîchement pressé",
      price: 400,
      servingSize: "1 verre",
      image: "/images/menu/orange-juice.jpg",
      calories: 110,
      protein: 2,
      carbs: 26,
      fat: 0,
      nutritionalTip: "Riche en vitamine C",
      isVegetarian: true,
      isVegan: true,
      isGlutenFree: true,
      isDairyFree: true,
    },
    {
      name: "Thé Glacé Maison",
      description: "Thé glacé maison au citron",
      price: 350,
      servingSize: "1 verre",
      image: "/images/menu/iced-tea.jpg",
      calories: 80,
      protein: 0,
      carbs: 20,
      fat: 0,
      nutritionalTip: "Rafraîchissant et désaltérant",
      isVegetarian: true,
      isVegan: true,
      isGlutenFree: true,
      isDairyFree: true,
    },
  ],
};

async function migrate() {
  console.log("Starting product migration...");

  if (!process.env.DATABASE_URL) {
    console.error("DATABASE_URL not found in environment variables");
    process.exit(1);
  }

  const db = drizzle(process.env.DATABASE_URL);

  let totalImported = 0;
  let displayOrder = 0;

  for (const [category, items] of Object.entries(menuData)) {
    console.log(`\nImporting ${items.length} products from category: ${category}`);

    for (const item of items) {
      try {
        await db.insert(products).values({
          name: item.name,
          description: item.description,
          category: category,
          price: item.price,
          servingSize: item.servingSize,
          image: item.image,
          calories: item.calories,
          protein: item.protein,
          carbs: item.carbs,
          fat: item.fat,
          nutritionalTip: item.nutritionalTip,
          isVegetarian: item.isVegetarian,
          isVegan: item.isVegan,
          isGlutenFree: item.isGlutenFree,
          isDairyFree: item.isDairyFree,
          isActive: true,
          displayOrder: displayOrder++,
        });

        console.log(`  ✓ Imported: ${item.name}`);
        totalImported++;
      } catch (error) {
        console.error(`  ✗ Failed to import ${item.name}:`, error.message);
      }
    }
  }

  console.log(`\n✅ Migration complete! Imported ${totalImported} products.`);
  process.exit(0);
}

migrate().catch((error) => {
  console.error("Migration failed:", error);
  process.exit(1);
});
